<!DOCTYPE html>
<meta charset="utf-8">
<style>

.ticks {
  font: 10px sans-serif;
}

.track,
.track-inset,
.track-overlay {
  stroke-linecap: round;
}

.track {
  stroke: #000;
  stroke-opacity: 0.3;
  stroke-width: 10px;
}

.track-inset {
  stroke: #ddd;
  stroke-width: 8px;
}

.track-overlay {
  pointer-events: stroke;
  stroke-width: 50px;
  stroke: transparent;
  cursor: crosshair;
}

.handle {
  fill: #fff;
  stroke: #000;
  stroke-opacity: 0.5;
  stroke-width: 1.25px;
}

</style>


<!-- python -m http.server 8001 -->
<svg width="960" height="500"></svg>  
<body>

<!-- Sample text output !-->
<p id="demo"></p>
<p id="demo1"></p>



<script src="//d3js.org/d3.v4.min.js"></script>
<script>

//Slider svg
var svg = d3.select("svg"),
    tmargin = {right: 50, left: 50},
    twidth = +svg.attr("width") - tmargin.left - tmargin.right,
    theight = +svg.attr("height");


var x_t = d3.scaleLinear()
    .domain([1976, 2010])
    .range([0, twidth])
    .clamp(true);

var slider = svg.append("g") 
    .attr("class", "slider")
    .attr("transform", "translate(" + tmargin.left + "," + theight / 2 + ")");

slider.append("line")
    .attr("class", "track")
    .attr("x1", x_t.range()[0])
    .attr("x2", x_t.range()[1])
  .select(function() { return this.parentNode.appendChild(this.cloneNode(true)); })
    .attr("class", "track-inset")
  .select(function() { return this.parentNode.appendChild(this.cloneNode(true)); })
    .attr("class", "track-overlay")
    .call(d3.drag()
        .on("start.interrupt", function() { slider.interrupt(); })
        //.on("start drag", function() { hue(x_t.invert(d3.event.x)); }) //); // this changes color
        .on("end drag", function() { update_year(x_t.invert(d3.event.x));}));  //updates year

slider.insert("g", ".track-overlay")
    .attr("class", "ticks")
    .attr("transform", "translate(0," + 18 + ")")
  .selectAll("text")
  .data(x_t.ticks(11))
  .enter().append("text")
    .attr("x", x_t)
    .attr("text-anchor", "middle")
    .text(function(d) { return d ; });

var handle = slider.insert("circle", ".track-overlay")
    .attr("class", "handle")
    .attr("r", 9);

slider.transition() // Gratuitous intro!
    .duration(750)
    .tween("hue", function() {
      var i = d3.interpolate(1976, 2000);
      return function(t) { update_year(i(t)); };
    });

//Change color on slide (Turned off)
function hue(h) {
  handle.attr("cx", x_t(h));
  svg.style("background-color", d3.hsl(h, 0.8, 0.8));
}

//Update global year variable, update text
var yearout = 0
function update_year(h) {
	handle.attr("cx", x_t(h));
	ye = Math.round(h);
	document.getElementById("demo").innerHTML = ye +" --- " + yearout;
	
	window['year'] = ye;
	window['yearout'] = ye;
	
	build_bar(ye);

  if (year <= 1985) {
    document.getElementById("demo1").innerHTML = "";
  }
	
	if (year > 1985) {
		document.getElementById("demo1").innerHTML = yearout + " We are now entering the golden age!";
	}
	if (year > 1992) {
		document.getElementById("demo1").innerHTML = yearout + " Matt has been born!";
	}
}


//INCORPORATE BAR CHART
/////////////////////////////////////
var margin = {top: 40, right: 40, bottom: 60, left: 130},
    width = 960 - margin.left - margin.right, 
    height = 600 - margin.top - margin.bottom;

// set the ranges
var y = d3.scaleBand()
          .range([height, 0])
          .padding(0.12);

var x = d3.scaleLinear()
          .range([0, width]);

var z = d3.scaleOrdinal()
    .range(["#98abc5", "#8a89a6", "#7b6888", "#6b486b", "#a05d56", "#d0743c", "#ff8c00"]);


/// create svg
var nbar = d3.select("body").append("svg")
    .attr("width", width + margin.left + margin.right + 40)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", 
          "translate(" + margin.left + "," + margin.top + ")");

//Function to update svg
function build_bar(ye){
year = ye
nbar.selectAll(".bar").remove();
nbar.selectAll("text").remove();
nbar.selectAll("g").remove();
        
d3.csv("../Data/team_means.csv", function(error, data) {
  if(error) throw error;

  data.forEach(function(d){
  		d.Year = +d.Year
    	d.height = +d.height
    	d.Age = +d.Age
    	d.Age = Math.round(d.Age)
    
  })
  
  //Filter data based on slider year
  var data = data.filter(function(d) { return d.Year == window['year']; });
	//console.log(data)
  
    data.sort(function(a, b) {
        return d3.ascending(a.height, b.height)
      });
  
  // Scale the range of the data in the domains
  x.domain([0, d3.max(data, function(d){ return d.height; })])
  y.domain(data.map(function(d) { return d.Tm; }));
  

  //append the rectangles for the bar chart
  nbar.selectAll(".bar")
      .data(data)
    .enter().append("rect")
      .attr("class", "bar")
      .attr("width", function(d) {return x(d.height); } )
      .attr("y", function(d) { return y(d.Tm); })
      .attr("height", y.bandwidth())
      .attr("fill", function(d) { return z(Math.round(d["Age"])); }); 
      

  // add the x Axis
  nbar.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));

  nbar.append("text")             
      .attr("transform",
            "translate(" + (width/2) + " ," + 
                           (height + margin.top - 5) + ")")
      .style("text-anchor", "middle")
      .text("Height (cm)");

  nbar.append("text")
  	  .attr("transform",
            "translate(" + (width/2) + " ," + 
                           (-10) + ")")
      .style("text-anchor", "middle")
      .text("NBA Teams by Height in "+year);

  // add the y Axis
  nbar.append("g")
      .call(d3.axisLeft(y));
      
// Add Legend
var legend = nbar.append("g")
      .attr("font-family", "sans-serif")
      .attr("font-size", 10)
      .attr("text-anchor", "end")
    .selectAll("g")
    .data(d3.map(data.sort(function(a, b) {
        return d3.ascending(a.Age, b.Age)
      })
      , function(d){return d["Age"];}).keys())
    .enter().append("g")
      .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });

  legend.append("rect")
      .attr("x", width + 50) //19
      .attr("width", 19)
      .attr("height", 19)
      .attr("fill", z);

  legend.append("text")
      .attr("x", width + 50 - 5) 
      .attr("y", 9.5)
      .attr("dy", "0.32em")
      .text(function(d) { return d+" yrs"; });


      
});

} //function close


</script>

</body>